{"version":3,"sources":["../src/edge.ts"],"names":["getClient","init","track","sanitizeHeaders","safeStringify","coreFlush"],"mappings":"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","file":"edge.js","sourcesContent":["/**\n * @outboundiq/nextjs/edge\n * \n * Edge runtime support for Next.js middleware and edge API routes\n * \n * @example\n * ```typescript\n * // In Edge API route or middleware\n * import { trackFetch } from '@outboundiq/nextjs/edge';\n * \n * export const runtime = 'edge';\n * \n * export async function GET(request: Request) {\n *   // Manually track a fetch in edge runtime\n *   const response = await trackFetch('https://api.example.com/data', {\n *     method: 'GET',\n *   });\n *   \n *   return Response.json(await response.json());\n * }\n * ```\n */\n\nimport {\n  init,\n  track,\n  getClient,\n  flush as coreFlush,\n  sanitizeHeaders,\n  safeStringify,\n  type OutboundIQConfig,\n  type UserContext,\n} from '@outbound_iq/core';\n\nlet isInitialized = false;\n\n/**\n * Ensure SDK is initialized\n */\nfunction ensureInitialized(): boolean {\n  if (isInitialized || getClient()) {\n    return true;\n  }\n\n  const apiKey = process.env.OUTBOUNDIQ_KEY;\n  const endpoint = process.env.OUTBOUNDIQ_URL;\n\n  if (!apiKey) {\n    console.warn('[OutboundIQ] Missing OUTBOUNDIQ_KEY environment variable');\n    return false;\n  }\n\n  init({\n    apiKey,\n    endpoint,\n    debug: process.env.OUTBOUNDIQ_DEBUG === 'true',\n    batchSize: 1, // Send immediately for serverless\n    flushInterval: 1000,\n  });\n\n  isInitialized = true;\n  console.log('[OutboundIQ] Auto-initialized for trackFetch');\n  return true;\n}\n\n/**\n * Initialize OutboundIQ for Edge runtime\n * Call this once at the start of your edge function\n */\nexport function initEdge(config?: Partial<OutboundIQConfig>): void {\n  if (isInitialized) return;\n\n  const apiKey = config?.apiKey || process.env.OUTBOUNDIQ_KEY;\n\n  if (!apiKey) {\n    console.warn('[OutboundIQ] Missing API key for edge runtime');\n    return;\n  }\n\n  init({\n    apiKey,\n    endpoint: config?.endpoint || process.env.OUTBOUNDIQ_URL,\n    debug: config?.debug || process.env.OUTBOUNDIQ_DEBUG === 'true',\n    // Smaller batches for edge (short-lived)\n    batchSize: config?.batchSize || 5,\n    flushInterval: config?.flushInterval || 1000,\n    ...config,\n  });\n\n  isInitialized = true;\n}\n\n/** Max chars for request/response body capture (~60k to fit MySQL TEXT; use MEDIUMTEXT migration for larger) */\nconst BODY_MAX_LENGTH = 60_000;\n\n/** Extract request headers from input and init */\nfunction extractRequestHeaders(\n  input: RequestInfo | URL,\n  init?: RequestInit\n): Record<string, string> {\n  const headers: Record<string, string> = {};\n  if (init?.headers) {\n    if (init.headers instanceof Headers) {\n      init.headers.forEach((value, key) => {\n        headers[key] = value;\n      });\n    } else if (Array.isArray(init.headers)) {\n      init.headers.forEach(([key, value]) => {\n        headers[key] = value;\n      });\n    } else {\n      Object.assign(headers, init.headers);\n    }\n  }\n  if (input instanceof Request) {\n    input.headers.forEach((value, key) => {\n      if (!headers[key]) headers[key] = value;\n    });\n  }\n  return headers;\n}\n\n/** Safely get request body string from init (for tracking) */\nfunction getRequestBodyFromInit(init?: RequestInit): string | null {\n  if (!init?.body) return null;\n  try {\n    if (typeof init.body === 'string') {\n      return init.body.length > BODY_MAX_LENGTH\n        ? init.body.substring(0, BODY_MAX_LENGTH) + '...[truncated]'\n        : init.body;\n    }\n    if (init.body instanceof FormData) return '[FormData]';\n    if (init.body instanceof URLSearchParams) {\n      const s = init.body.toString();\n      return s.length > BODY_MAX_LENGTH ? s.substring(0, BODY_MAX_LENGTH) + '...[truncated]' : s;\n    }\n    if (init.body instanceof ArrayBuffer || init.body instanceof Uint8Array) {\n      return `[Binary: ${(init.body as ArrayBuffer).byteLength} bytes]`;\n    }\n    return '[Body]';\n  } catch {\n    return null;\n  }\n}\n\n/** Clone response and read body for tracking (truncated) */\nasync function getResponseBodyForTracking(response: Response): Promise<string | null> {\n  try {\n    const clone = response.clone();\n    const text = await clone.text();\n    return text.length > BODY_MAX_LENGTH\n      ? text.substring(0, BODY_MAX_LENGTH) + '...[truncated]'\n      : text;\n  } catch {\n    return null;\n  }\n}\n\n/** Response headers as plain object */\nfunction getResponseHeadersMap(response: Response): Record<string, string> {\n  const out: Record<string, string> = {};\n  response.headers.forEach((value, key) => {\n    out[key] = value;\n  });\n  return out;\n}\n\n/**\n * Track a fetch request manually\n * Auto-initializes SDK if not already done.\n * Captures request/response headers and bodies for OutboundIQ.\n */\nexport async function trackFetch(\n  input: RequestInfo | URL,\n  init?: RequestInit & { userContext?: UserContext }\n): Promise<Response> {\n  const initialized = ensureInitialized();\n\n  const startTime = performance.now();\n  const url =\n    typeof input === 'string' ? input : input instanceof URL ? input.toString() : input.url;\n  const method = init?.method || 'GET';\n  const userContext = init?.userContext;\n\n  const requestHeaders = extractRequestHeaders(input, init);\n  const requestBody = getRequestBodyFromInit(init);\n\n  const fetchInit = init ? { ...init } : undefined;\n  if (fetchInit) {\n    delete (fetchInit as any).userContext;\n  }\n\n  try {\n    const response = await fetch(input, fetchInit);\n    const duration = performance.now() - startTime;\n\n    if (initialized) {\n      const responseBody = await getResponseBodyForTracking(response);\n      track({\n        method: method.toUpperCase(),\n        url,\n        statusCode: response.status,\n        duration,\n        requestHeaders: sanitizeHeaders(requestHeaders),\n        responseHeaders: sanitizeHeaders(getResponseHeadersMap(response)),\n        requestBody: safeStringify(requestBody, BODY_MAX_LENGTH),\n        responseBody: safeStringify(responseBody, BODY_MAX_LENGTH),\n        userContext: userContext || null,\n      });\n      await coreFlush();\n    }\n\n    return response;\n  } catch (error) {\n    const duration = performance.now() - startTime;\n\n    if (initialized) {\n      track({\n        method: method.toUpperCase(),\n        url,\n        statusCode: 0,\n        duration,\n        requestHeaders: sanitizeHeaders(requestHeaders),\n        requestBody: safeStringify(requestBody, BODY_MAX_LENGTH),\n        error: error instanceof Error ? error.message : 'Unknown error',\n        userContext: userContext || null,\n      });\n      await coreFlush();\n    }\n\n    throw error;\n  }\n}\n\n/**\n * Create a tracked fetch function with pre-configured user context\n */\nexport function createTrackedFetch(userContext: UserContext) {\n  return async function trackedFetch(\n    input: RequestInfo | URL,\n    init?: RequestInit\n  ): Promise<Response> {\n    return trackFetch(input, { ...init, userContext });\n  };\n}\n\n// Re-export useful functions\nexport { track, flush, setUserContext } from '@outbound_iq/core';\nexport type { UserContext } from '@outbound_iq/core';\n\n// ============================================\n// SDK Methods: recommend, providerStatus, endpointStatus\n// ============================================\n\n/**\n * Common options for SDK methods\n */\ninterface SdkMethodOptions {\n  userContext?: UserContext;\n  requestId?: string;\n}\n\n/**\n * Recommendation response from the API\n */\ninterface RecommendResponse {\n  success: boolean;\n  service?: {\n    name: string;\n    description: string;\n    strategy: string;\n  };\n  recommendation?: {\n    provider: string;\n    endpoint: string;\n    confidence: number;\n    reason: string;\n  };\n  alternatives?: Array<{\n    provider: string;\n    endpoint: string;\n    confidence: number;\n  }>;\n  error?: string;\n}\n\n/**\n * Provider status response from the API\n */\ninterface ProviderStatusResponse {\n  success: boolean;\n  provider?: {\n    name: string;\n    slug: string;\n    status: string;\n    description: string;\n  };\n  metrics?: {\n    success_rate: number;\n    average_latency: number;\n    total_requests: number;\n  };\n  incidents?: Array<{\n    title: string;\n    status: string;\n    created_at: string;\n  }>;\n  error?: string;\n}\n\n/**\n * Endpoint status response from the API\n */\ninterface EndpointStatusResponse {\n  success: boolean;\n  endpoint?: {\n    name: string;\n    slug: string;\n    method: string;\n    url_pattern: string;\n  };\n  metrics?: {\n    success_rate: number;\n    average_latency: number;\n    total_requests: number;\n  };\n  provider?: {\n    name: string;\n    status: string;\n  };\n  error?: string;\n}\n\n/**\n * Get the base API URL from environment\n */\nfunction getBaseUrl(): string {\n  // Use the main API, not the metric endpoint\n  const endpoint = process.env.OUTBOUNDIQ_URL || 'https://agent.outboundiq.dev/api/metric';\n  // Convert metric endpoint to base API URL\n  // https://agent.outboundiq.dev/api/metric â†’ https://agent.outboundiq.dev/api\n  return endpoint.replace('/metric', '');\n}\n\n/**\n * Get recommendation for a service\n * \n * Returns the best provider/endpoint to use based on:\n * - Your actual API usage data (success rate, latency, stability)\n * - Provider status page health\n * - Recent incidents\n * \n * @example\n * ```typescript\n * const result = await recommend('payment-processing');\n * if (result?.success && result.recommendation) {\n *   console.log(`Use ${result.recommendation.provider} (${result.recommendation.confidence}% confidence)`);\n * }\n * ```\n */\nexport async function recommend(\n  serviceName: string,\n  options: SdkMethodOptions = {}\n): Promise<RecommendResponse | null> {\n  const apiKey = process.env.OUTBOUNDIQ_KEY;\n  if (!apiKey) {\n    console.warn('[OutboundIQ] Missing API key for recommend()');\n    return null;\n  }\n\n  try {\n    const url = `${getBaseUrl()}/v1/recommend/${encodeURIComponent(serviceName)}`;\n    const requestId = options.requestId || crypto.randomUUID();\n\n    const headers: Record<string, string> = {\n      'Authorization': `Bearer ${apiKey}`,\n      'Accept': 'application/json',\n      'X-Request-Id': requestId,\n    };\n\n    if (options.userContext) {\n      headers['X-User-Context'] = JSON.stringify(options.userContext);\n    }\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers,\n    });\n\n    return await response.json();\n  } catch (error) {\n    console.error('[OutboundIQ] recommend() failed:', error);\n    return null;\n  }\n}\n\n/**\n * Get status and metrics for a provider\n * \n * Returns real-time actionable data for decision-making:\n * - Provider status (from status page)\n * - Aggregate metrics (success rate, latency)\n * - Active incidents\n * \n * @example\n * ```typescript\n * const status = await providerStatus('stripe');\n * if (status?.provider?.status === 'operational') {\n *   // Safe to use Stripe\n * }\n * ```\n */\nexport async function providerStatus(\n  providerSlug: string,\n  options: SdkMethodOptions = {}\n): Promise<ProviderStatusResponse | null> {\n  const apiKey = process.env.OUTBOUNDIQ_KEY;\n  if (!apiKey) {\n    console.warn('[OutboundIQ] Missing API key for providerStatus()');\n    return null;\n  }\n\n  try {\n    const url = `${getBaseUrl()}/v1/provider/${encodeURIComponent(providerSlug)}/status`;\n\n    const headers: Record<string, string> = {\n      'Authorization': `Bearer ${apiKey}`,\n      'Accept': 'application/json',\n    };\n\n    if (options.userContext) {\n      headers['X-User-Context'] = JSON.stringify(options.userContext);\n    }\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers,\n    });\n\n    return await response.json();\n  } catch (error) {\n    console.error('[OutboundIQ] providerStatus() failed:', error);\n    return null;\n  }\n}\n\n/**\n * Get status and metrics for a specific endpoint\n * \n * Returns real-time actionable data for decision-making:\n * - Endpoint-specific metrics (success rate, latency)\n * - Provider status\n * - Active incidents\n * \n * @example\n * ```typescript\n * const status = await endpointStatus('stripe-post-charges');\n * if (status?.metrics?.success_rate > 99) {\n *   // Endpoint is healthy\n * }\n * ```\n */\nexport async function endpointStatus(\n  endpointSlug: string,\n  options: SdkMethodOptions = {}\n): Promise<EndpointStatusResponse | null> {\n  const apiKey = process.env.OUTBOUNDIQ_KEY;\n  if (!apiKey) {\n    console.warn('[OutboundIQ] Missing API key for endpointStatus()');\n    return null;\n  }\n\n  try {\n    const url = `${getBaseUrl()}/v1/endpoint/${encodeURIComponent(endpointSlug)}/status`;\n\n    const headers: Record<string, string> = {\n      'Authorization': `Bearer ${apiKey}`,\n      'Accept': 'application/json',\n    };\n\n    if (options.userContext) {\n      headers['X-User-Context'] = JSON.stringify(options.userContext);\n    }\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers,\n    });\n\n    return await response.json();\n  } catch (error) {\n    console.error('[OutboundIQ] endpointStatus() failed:', error);\n    return null;\n  }\n}\n\n/**\n * Axios interceptor types\n */\ninterface AxiosResponse {\n  status: number;\n  config: {\n    url?: string;\n    method?: string;\n    baseURL?: string;\n    headers?: Record<string, string>;\n    data?: unknown;\n    metadata?: { startTime: number };\n  };\n  headers?: Record<string, string>;\n  data?: unknown;\n}\n\ninterface AxiosError {\n  config?: AxiosResponse['config'];\n  response?: AxiosResponse;\n  message: string;\n}\n\ninterface AxiosInstance {\n  interceptors: {\n    request: {\n      use: (\n        onFulfilled?: (config: any) => any,\n        onRejected?: (error: any) => any\n      ) => number;\n    };\n    response: {\n      use: (\n        onFulfilled?: (response: any) => any,\n        onRejected?: (error: any) => any\n      ) => number;\n    };\n  };\n  \n  get: <T = any>(url: string, config?: any) => Promise<{ data: T; status: number; headers: any; config: any }>;\n  post: <T = any>(url: string, data?: any, config?: any) => Promise<{ data: T; status: number; headers: any; config: any }>;\n  put: <T = any>(url: string, data?: any, config?: any) => Promise<{ data: T; status: number; headers: any; config: any }>;\n  patch: <T = any>(url: string, data?: any, config?: any) => Promise<{ data: T; status: number; headers: any; config: any }>;\n  delete: <T = any>(url: string, config?: any) => Promise<{ data: T; status: number; headers: any; config: any }>;\n  head: <T = any>(url: string, config?: any) => Promise<{ data: T; status: number; headers: any; config: any }>;\n  options: <T = any>(url: string, config?: any) => Promise<{ data: T; status: number; headers: any; config: any }>;\n  request: <T = any>(config: any) => Promise<{ data: T; status: number; headers: any; config: any }>;\n  // Instance properties\n  defaults: any;\n}\n\n/**\n * Add OutboundIQ tracking to an existing axios instance\n * \n * This adds interceptors without removing existing ones.\n * Works with any axios instance that already has interceptors.\n * \n * @example\n * ```typescript\n * import axios from 'axios';\n * import { addAxiosTracking } from '@outboundiq/nextjs/edge';\n * \n * // Your existing axios instance with interceptors\n * const api = axios.create({ baseURL: 'https://api.example.com' });\n * api.interceptors.request.use(config => {\n *   config.headers.Authorization = `Bearer ${token}`;\n *   return config;\n * });\n * \n * // Add OutboundIQ tracking (doesn't remove existing interceptors)\n * addAxiosTracking(api);\n * \n * // Now all calls are tracked!\n * await api.get('/users');\n * ```\n */\nexport function addAxiosTracking(\n  axiosInstance: AxiosInstance,\n  options?: { userContext?: UserContext }\n): void {\n  // Ensure SDK is initialized\n  ensureInitialized();\n\n  // Request interceptor - record start time\n  axiosInstance.interceptors.request.use(\n    (config: any) => {\n      config.metadata = { startTime: performance.now() };\n      return config;\n    },\n    (error: any) => Promise.reject(error)\n  );\n\n  // Response interceptor - track successful calls (with request/response body and headers)\n  axiosInstance.interceptors.response.use(\n    async (response: AxiosResponse) => {\n      const duration = response.config.metadata?.startTime\n        ? performance.now() - response.config.metadata.startTime\n        : 0;\n\n      const url = buildAxiosUrl(response.config);\n      const requestHeaders = normalizeAxiosHeaders(response.config.headers);\n      const responseHeaders = normalizeAxiosHeaders(response.headers);\n\n      track({\n        method: (response.config.method || 'GET').toUpperCase(),\n        url,\n        statusCode: response.status,\n        duration,\n        requestHeaders: sanitizeHeaders(requestHeaders),\n        responseHeaders: sanitizeHeaders(responseHeaders),\n        requestBody: safeStringify(response.config.data, BODY_MAX_LENGTH),\n        responseBody: safeStringify(response.data, BODY_MAX_LENGTH),\n        userContext: options?.userContext || null,\n      });\n\n      // Flush for serverless\n      await coreFlush();\n\n      return response;\n    },\n    async (error: AxiosError) => {\n      const duration = error.config?.metadata?.startTime\n        ? performance.now() - error.config.metadata.startTime\n        : 0;\n\n      const url = error.config ? buildAxiosUrl(error.config) : 'unknown';\n      const requestHeaders = normalizeAxiosHeaders(error.config?.headers);\n      const responseHeaders = normalizeAxiosHeaders(error.response?.headers);\n\n      track({\n        method: (error.config?.method || 'GET').toUpperCase(),\n        url,\n        statusCode: error.response?.status || 0,\n        duration,\n        requestHeaders: sanitizeHeaders(requestHeaders),\n        responseHeaders: sanitizeHeaders(responseHeaders),\n        requestBody: safeStringify(error.config?.data, BODY_MAX_LENGTH),\n        responseBody: safeStringify(error.response?.data, BODY_MAX_LENGTH),\n        error: error.message,\n        userContext: options?.userContext || null,\n      });\n\n      await coreFlush();\n\n      return Promise.reject(error);\n    }\n  );\n}\n\n/**\n * Normalize Axios headers to a plain Record<string, string>.\n * Axios uses AxiosHeaders which doesn't serialize with Object.entries correctly;\n * toJSON(true) returns a plain object with string values.\n */\nfunction normalizeAxiosHeaders(headers: unknown): Record<string, string> {\n  if (!headers) return {};\n  const h = headers as { toJSON?: (asStrings?: boolean) => Record<string, string> };\n  if (typeof h.toJSON === 'function') {\n    const obj = h.toJSON(true);\n    if (obj && typeof obj === 'object' && !Array.isArray(obj)) {\n      const out: Record<string, string> = {};\n      for (const [k, v] of Object.entries(obj)) {\n        if (v != null && typeof v === 'string') out[k] = v;\n        else if (v != null) out[k] = String(v);\n      }\n      return out;\n    }\n  }\n  if (headers instanceof Headers) {\n    const out: Record<string, string> = {};\n    headers.forEach((value, key) => {\n      out[key] = value;\n    });\n    return out;\n  }\n  if (typeof headers === 'object' && !Array.isArray(headers)) {\n    return headers as Record<string, string>;\n  }\n  return {};\n}\n\n/**\n * Build full URL from axios config\n */\nfunction buildAxiosUrl(config: AxiosResponse['config']): string {\n  const baseURL = config.baseURL || '';\n  const url = config.url || '';\n  \n  if (url.startsWith('http://') || url.startsWith('https://')) {\n    return url;\n  }\n  \n  return baseURL + url;\n}\n\n/**\n * Create a tracked axios instance\n * \n * @example\n * ```typescript\n * import axios from 'axios';\n * import { createTrackedAxios } from '@outboundiq/nextjs/edge';\n * \n * const api = createTrackedAxios(axios, {\n *   baseURL: 'https://api.example.com',\n * });\n * \n * await api.get('/users'); // Automatically tracked!\n * ```\n */\nexport function createTrackedAxios(\n  axios: { create: (config?: any) => AxiosInstance },\n  config?: any,\n  options?: { userContext?: UserContext }\n): AxiosInstance {\n  const instance = axios.create(config);\n  addAxiosTracking(instance, options);\n  return instance;\n}\n\n"]}